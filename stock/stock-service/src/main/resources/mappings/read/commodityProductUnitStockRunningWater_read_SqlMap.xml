<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.stock.dao.read.CommodityProductUnitStockRunningWaterReadDAO">
	<resultMap type="com.egeo.components.stock.po.CommodityProductUnitStockRunningWaterPO" id="commodityProductUnitStockRunningWaterMap">
		<result property="id" column="id" />
		<result property="commodityProductUnitId" column="commodity_product_unit_id" />
		<result property="productUnitSerialNumber" column="product_unit_serial_number" />
		<result property="commodityProductUnitName" column="commodity_product_unit_name" />
		<result property="preoperativeStockNum" column="preoperative_stock_num" />
		<result property="operationBackStockNum" column="operation_back_stock_num" />
		<result property="stockChange" column="stock_change" />
		<result property="createUserid" column="create_userid" />
		<result property="createUsername" column="create_username" />
		<result property="createUserip" column="create_userip" />
		<result property="createUsermac" column="create_usermac" />
		<result property="createTime" column="create_time" />
		<result property="platformId" column="platform_id" />
		<result property="enterpriseId" column="enterprise_id" />
		<result property="preoperativeRealStockNum" column="preoperative_real_stock_num" />
		<result property="operationBackRealStockNum" column="operation_back_real_stock_num" />
		<result property="type" column="type" />
		<result property="orderCode" column="order_code" />
		<result property="contactGroupStockId" column="contact_group_stock_id" />
	</resultMap>
	
	<resultMap type="com.egeo.components.stock.condition.CommodityProductUnitStockRunningWaterCondition" extends="commodityProductUnitStockRunningWaterMap" id="commodityProductUnitStockRunningWaterCondition">
		<result property="contactGroupStockName" column="contact_group_stock_name" />
	</resultMap>

	<sql id="commodityProductUnitStockRunningWaterColumns">
		id,
		commodity_product_unit_id,
		product_unit_serial_number,
		commodity_product_unit_name,
		preoperative_stock_num,
		operation_back_stock_num,
		stock_change,
		create_userid,
		create_username,
		create_userip,
		create_usermac,
		create_time,
		platform_id,
		enterprise_id,
		preoperative_real_stock_num,
		operation_back_real_stock_num,
		type,
		order_code,
		contact_group_stock_id
	</sql>
	
	<sql id="commodityProductUnitStockRunningWaterCondition">
		cp.id,
		cp.commodity_product_unit_id,
		cp.product_unit_serial_number,
		cp.commodity_product_unit_name,
		cp.preoperative_stock_num,
		cp.operation_back_stock_num,
		cp.stock_change,
		cp.create_userid,
		cp.create_username,
		cp.create_userip,
		cp.create_usermac,
		cp.create_time,
		cp.platform_id,
		cp.enterprise_id,
		cp.preoperative_real_stock_num,
		cp.operation_back_real_stock_num,
		cp.type,
		cp.order_code,
		cp.contact_group_stock_id,
		cgs.name as contact_group_stock_name
	</sql>

	<select id="findById" parameterType="com.egeo.components.stock.po.CommodityProductUnitStockRunningWaterPO" resultMap="commodityProductUnitStockRunningWaterMap">
		SELECT
		<include refid="commodityProductUnitStockRunningWaterColumns" />
		FROM commodity_product_unit_stock_running_water
		WHERE id = #{po.id}
	</select>
	
	<select id="findOfPage" resultMap="commodityProductUnitStockRunningWaterMap">
		SELECT
		<include refid="commodityProductUnitStockRunningWaterColumns" />
		FROM commodity_product_unit_stock_running_water
		<where>
			<if test="po.commodityProductUnitId != null">
				and commodity_product_unit_id = #{po.commodityProductUnitId}
			</if>
			<if test="po.productUnitSerialNumber != null">
				and product_unit_serial_number like concat('%',#{po.productUnitSerialNumber},'%')
			</if>
			<if test="po.commodityProductUnitName != null">
				and commodity_product_unit_name like concat('%',#{po.commodityProductUnitName},'%')
			</if>
			<if test="po.preoperativeStockNum != null">
				and preoperative_stock_num = #{po.preoperativeStockNum}
			</if>
			<if test="po.operationBackStockNum != null">
				and operation_back_stock_num = #{po.operationBackStockNum}
			</if>
			<if test="po.stockChange != null">
				and stock_change = #{po.stockChange}
			</if>
			<if test="po.createUserid != null">
				and create_userid = #{po.createUserid}
			</if>
			<if test="po.createUsername != null">
				and create_username like concat('%',#{po.createUsername},'%')
			</if>
			<if test="po.createUserip != null">
				and create_userip = #{po.createUserip}
			</if>
			<if test="po.createUsermac != null">
				and create_usermac = #{po.createUsermac}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.enterpriseId != null">
				and enterprise_id = #{po.enterpriseId}
			</if>
			<if test="po.preoperativeRealStockNum != null">
				and preoperative_real_stock_num = #{po.preoperativeRealStockNum}
			</if>
			<if test="po.operationBackRealStockNum != null">
				and operation_back_real_stock_num = #{po.operationBackRealStockNum}
			</if>
			<if test="po.type != null">
				and type = #{po.type}
			</if>
			<if test="po.orderCode != null">
				and order_code = #{po.orderCode}
			</if>
			<if test="po.createTimeFront != null">
				and create_time > #{po.createTimeFront}
			</if>
			<if test="po.createTimeBack != null">
				and #{po.createTimeBack} > create_time
			</if>
			<if test="po.contactGroupStockId != null">
				and contact_group_stock_id = #{po.contactGroupStockId}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>		
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
		<if test="page != null">
		limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>

	<select id="findConditionOfPage" resultMap="commodityProductUnitStockRunningWaterCondition">
		SELECT
		<include refid="commodityProductUnitStockRunningWaterCondition" />
		FROM commodity_product_unit_stock_running_water cp
		left join contact_group_stock cgs on cp.contact_group_stock_id = cgs.id
		<where>
			<if test="po.commodityProductUnitId != null">
				and cp.commodity_product_unit_id = #{po.commodityProductUnitId}
			</if>
			<if test="po.productUnitSerialNumber != null">
				and cp.product_unit_serial_number like concat('%',#{po.productUnitSerialNumber},'%')
			</if>
			<if test="po.commodityProductUnitName != null">
				and cp.commodity_product_unit_name like concat('%',#{po.commodityProductUnitName},'%')
			</if>
			<if test="po.preoperativeStockNum != null">
				and cp.preoperative_stock_num = #{po.preoperativeStockNum}
			</if>
			<if test="po.operationBackStockNum != null">
				and cp.operation_back_stock_num = #{po.operationBackStockNum}
			</if>
			<if test="po.stockChange != null">
				and cp.stock_change = #{po.stockChange}
			</if>
			<if test="po.createUserid != null">
				and cp.create_userid = #{po.createUserid}
			</if>
			<if test="po.createUsername != null">
				and cp.create_username like concat('%',#{po.createUsername},'%')
			</if>
			<if test="po.createUserip != null">
				and cp.create_userip = #{po.createUserip}
			</if>
			<if test="po.createUsermac != null">
				and cp.create_usermac = #{po.createUsermac}
			</if>
			<if test="po.createTime != null">
				and cp.create_time = #{po.createTime}
			</if>
			<if test="po.platformId != null">
				and cp.platform_id = #{po.platformId}
			</if>
			<if test="po.enterpriseId != null">
				and cp.enterprise_id = #{po.enterpriseId}
			</if>
			<if test="po.preoperativeRealStockNum != null">
				and cp.preoperative_real_stock_num = #{po.preoperativeRealStockNum}
			</if>
			<if test="po.operationBackRealStockNum != null">
				and cp.operation_back_real_stock_num = #{po.operationBackRealStockNum}
			</if>
			<if test="po.type != null">
				and cp.type = #{po.type}
			</if>
			<if test="po.orderCode != null">
				and cp.order_code = #{po.orderCode}
			</if>
			<if test="po.createTimeFront != null">
				and cp.create_time > #{po.createTimeFront}
			</if>
			<if test="po.createTimeBack != null">
				and #{po.createTimeBack} > cp.create_time
			</if>
			<if test="po.contactGroupStockId != null">
				and cp.contact_group_stock_id = #{po.contactGroupStockId}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>		
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
		<if test="page != null">
		limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>
	
	<select id="countOfPage" resultType="java.lang.Integer">
		SELECT
		count(1) cnt
		FROM commodity_product_unit_stock_running_water
		<where>
			<if test="po.commodityProductUnitId != null">
				and commodity_product_unit_id = #{po.commodityProductUnitId}
			</if>
			<if test="po.productUnitSerialNumber != null">
				and product_unit_serial_number like concat('%',#{po.productUnitSerialNumber},'%')
			</if>
			<if test="po.commodityProductUnitName != null">
				and commodity_product_unit_name like concat('%',#{po.commodityProductUnitName},'%')
			</if>
			<if test="po.preoperativeStockNum != null">
				and preoperative_stock_num = #{po.preoperativeStockNum}
			</if>
			<if test="po.operationBackStockNum != null">
				and operation_back_stock_num = #{po.operationBackStockNum}
			</if>
			<if test="po.stockChange != null">
				and stock_change = #{po.stockChange}
			</if>
			<if test="po.createUserid != null">
				and create_userid = #{po.createUserid}
			</if>
			<if test="po.createUsername != null">
				and create_username like concat('%',#{po.createUsername},'%')
			</if>
			<if test="po.createUserip != null">
				and create_userip = #{po.createUserip}
			</if>
			<if test="po.createUsermac != null">
				and create_usermac = #{po.createUsermac}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.enterpriseId != null">
				and enterprise_id = #{po.enterpriseId}
			</if>
			<if test="po.preoperativeRealStockNum != null">
				and preoperative_real_stock_num = #{po.preoperativeRealStockNum}
			</if>
			<if test="po.operationBackRealStockNum != null">
				and operation_back_real_stock_num = #{po.operationBackRealStockNum}
			</if>
			<if test="po.type != null">
				and type = #{po.type}
			</if>
			<if test="po.orderCode != null">
				and order_code = #{po.orderCode}
			</if>
			<if test="po.createTimeFront != null">
				and create_time > #{po.createTimeFront}
			</if>
			<if test="po.createTimeBack != null">
				and #{po.createTimeBack} > create_time
			</if>
			<if test="po.contactGroupStockId != null">
				and contact_group_stock_id = #{po.contactGroupStockId}
			</if>
		</where>
	</select>
	
	<select id="findAll" resultMap="commodityProductUnitStockRunningWaterMap">
		SELECT
		<include refid="commodityProductUnitStockRunningWaterColumns" />
		FROM commodity_product_unit_stock_running_water
		<where>
			<if test="po.commodityProductUnitId != null">
				and commodity_product_unit_id = #{po.commodityProductUnitId}
			</if>
			<if test="po.productUnitSerialNumber != null">
				and product_unit_serial_number = #{po.productUnitSerialNumber}
			</if>
			<if test="po.commodityProductUnitName != null">
				and commodity_product_unit_name = #{po.commodityProductUnitName}
			</if>
			<if test="po.preoperativeStockNum != null">
				and preoperative_stock_num = #{po.preoperativeStockNum}
			</if>
			<if test="po.operationBackStockNum != null">
				and operation_back_stock_num = #{po.operationBackStockNum}
			</if>
			<if test="po.stockChange != null">
				and stock_change = #{po.stockChange}
			</if>
			<if test="po.createUserid != null">
				and create_userid = #{po.createUserid}
			</if>
			<if test="po.createUsername != null">
				and create_username = #{po.createUsername}
			</if>
			<if test="po.createUserip != null">
				and create_userip = #{po.createUserip}
			</if>
			<if test="po.createUsermac != null">
				and create_usermac = #{po.createUsermac}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.enterpriseId != null">
				and enterprise_id = #{po.enterpriseId}
			</if>
			<if test="po.preoperativeRealStockNum != null">
				and preoperative_real_stock_num = #{po.preoperativeRealStockNum}
			</if>
			<if test="po.operationBackRealStockNum != null">
				and operation_back_real_stock_num = #{po.operationBackRealStockNum}
			</if>
			<if test="po.type != null">
				and type = #{po.type}
			</if>
			<if test="po.orderCode != null">
				and order_code = #{po.orderCode}
			</if>
			<if test="po.contactGroupStockId != null">
				and contact_group_stock_id = #{po.contactGroupStockId}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>			
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllByOrderCodes" resultMap="commodityProductUnitStockRunningWaterMap">
		SELECT
		<include refid="commodityProductUnitStockRunningWaterColumns" />
		FROM commodity_product_unit_stock_running_water
		where order_code in
		<foreach collection="orderCodes" item="orderCode" open="(" separator="," close=")">
			#{orderCode}
		</foreach>
	</select>
	
	<select id="findAllByOrderCodesAndType" resultMap="commodityProductUnitStockRunningWaterMap">
		SELECT
		<include refid="commodityProductUnitStockRunningWaterColumns" />
		FROM commodity_product_unit_stock_running_water
		where 
		( type = #{type} or type = 104 )
		and order_code in
		<foreach collection="orderCodes" item="orderCode" open="(" separator="," close=")">
			#{orderCode}
		</foreach>
	</select>
	
	
</mapper>
	