<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.order.dao.read.ReceiverAddressReadDAO">

	<select id="queryReceiverAddressListCreatedByUser" resultMap="receiverAddressMap">
		select * from receiver_address
		where user_id=#{userId} and platform_id=#{platformId}
		and type=1
		order by create_time desc
	</select>
	<select id="queryReceiverAddressListCreateByBackStage" resultMap="receiverAddressMap">
		select * from receiver_address
		where so_child_code=#{childCode}
		and type=2
		order by create_time desc
	</select>

	<select id="queryReceiverAddressByChildCodeAndType" resultMap="receiverAddressMap">
		select * from receiver_address
		where so_child_code=#{childCode} and type=#{type}
	</select>





	<select id="receiverAddressSumByUserId" resultType="java.lang.Integer">
		select count(1) cnt from receiver_address
		where user_id=#{userId} and platform_id=#{platformId} and type=1
	</select>

	<resultMap type="com.egeo.components.order.po.ReceiverAddressPO" id="receiverAddressMap">
		<result property="id" column="id" />
		<result property="goodReceiverAddress" column="good_receiver_address" />
		<result property="goodReceiverPostcode" column="good_receiver_postcode" />
		<result property="goodReceiverName" column="good_receiver_name" />
		<result property="goodReceiverMobile" column="good_receiver_mobile" />
		<result property="goodReceiverPhone" column="good_receiver_phone" />
		<result property="goodReceiverCountryId" column="good_receiver_country_id" />
		<result property="goodReceiverCountry" column="good_receiver_country" />
		<result property="goodReceiverProvinceId" column="good_receiver_province_id" />
		<result property="goodReceiverProvince" column="good_receiver_province" />
		<result property="goodReceiverCityId" column="good_receiver_city_id" />
		<result property="goodReceiverCity" column="good_receiver_city" />
		<result property="goodReceiverCountyId" column="good_receiver_county_id" />
		<result property="goodReceiverCounty" column="good_receiver_county" />
		<result property="goodReceiverAreaId" column="good_receiver_area_id" />
		<result property="goodReceiverArea" column="good_receiver_area" />
		<result property="userId" column="user_id" />
		<result property="type" column="type" />
		<result property="createTime" column="create_time" />
		<result property="updateTime" column="update_time" />
		<result property="platformId" column="platform_id" />
		<result property="isDefault" column="is_default" />
		<result property="modifyMail" column="modify_mail" />
		<result property="soChildCode" column="so_child_code"/>
	</resultMap>
	<resultMap type="com.egeo.components.order.condition.ReceiverAddressCondition" id="receiverAddressConditionMap" extends="receiverAddressMap">
		<result property="soChildId" column="id" />
		<result property="deliveryDate" column="delivery_date" />
	</resultMap>

	<select id="queryDefaultReceiverAddress" resultMap="receiverAddressMap">
		select * from receiver_address
		where user_id=#{memberId} and platform_id = #{platformId}
		and is_default=1 and type = 1
	</select>

	<sql id="receiverAddressColumns">
		id,
		good_receiver_address,
		good_receiver_postcode,
		good_receiver_name,
		good_receiver_mobile,
		good_receiver_phone,
		good_receiver_country_id,
		good_receiver_country,
		good_receiver_province_id,
		good_receiver_province,
		good_receiver_city_id,
		good_receiver_city,
		good_receiver_county_id,
		good_receiver_county,
		good_receiver_area_id,
		good_receiver_area,
		user_id,
		type,
		create_time,
		update_time,
		platform_id,
		is_default,
		modify_mail
	</sql>

	<select id="findById" parameterType="com.egeo.components.order.po.ReceiverAddressPO" resultMap="receiverAddressMap">
		SELECT
		<include refid="receiverAddressColumns" />
		FROM receiver_address
		WHERE id = #{po.id}
	</select>

	<select id="findOfPage" resultMap="receiverAddressMap">
		SELECT
		<include refid="receiverAddressColumns" />
		FROM receiver_address
		<where>
			<if test="po.goodReceiverAddress != null">
				and good_receiver_address = #{po.goodReceiverAddress}
			</if>
			<if test="po.goodReceiverPostcode != null">
				and good_receiver_postcode = #{po.goodReceiverPostcode}
			</if>
			<if test="po.goodReceiverName != null">
				and good_receiver_name = #{po.goodReceiverName}
			</if>
			<if test="po.goodReceiverMobile != null">
				and good_receiver_mobile = #{po.goodReceiverMobile}
			</if>
			<if test="po.goodReceiverPhone != null">
				and good_receiver_phone = #{po.goodReceiverPhone}
			</if>
			<if test="po.goodReceiverCountryId != null">
				and good_receiver_country_id = #{po.goodReceiverCountryId}
			</if>
			<if test="po.goodReceiverCountry != null">
				and good_receiver_country = #{po.goodReceiverCountry}
			</if>
			<if test="po.goodReceiverProvinceId != null">
				and good_receiver_province_id = #{po.goodReceiverProvinceId}
			</if>
			<if test="po.goodReceiverProvince != null">
				and good_receiver_province = #{po.goodReceiverProvince}
			</if>
			<if test="po.goodReceiverCityId != null">
				and good_receiver_city_id = #{po.goodReceiverCityId}
			</if>
			<if test="po.goodReceiverCity != null">
				and good_receiver_city = #{po.goodReceiverCity}
			</if>
			<if test="po.goodReceiverCountyId != null">
				and good_receiver_county_id = #{po.goodReceiverCountyId}
			</if>
			<if test="po.goodReceiverCounty != null">
				and good_receiver_county = #{po.goodReceiverCounty}
			</if>
			<if test="po.goodReceiverAreaId != null">
				and good_receiver_area_id = #{po.goodReceiverAreaId}
			</if>
			<if test="po.goodReceiverArea != null">
				and good_receiver_area = #{po.goodReceiverArea}
			</if>
			<if test="po.userId != null">
				and user_id = #{po.userId}
			</if>
			<if test="po.type != null">
				and type = #{po.type}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.isDefault != null">
				and is_default = #{po.isDefault}
			</if>
			<if test="po.modifyMail != null">
				and modify_mail = #{po.modifyMail}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY id desc
			</otherwise>
		</choose>
		<if test="page != null">
		limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>

	<select id="countOfPage" resultType="java.lang.Integer">
		SELECT
		count(1) cnt
		FROM receiver_address
		<where>
			<if test="po.goodReceiverAddress != null">
				and good_receiver_address = #{po.goodReceiverAddress}
			</if>
			<if test="po.goodReceiverPostcode != null">
				and good_receiver_postcode = #{po.goodReceiverPostcode}
			</if>
			<if test="po.goodReceiverName != null">
				and good_receiver_name = #{po.goodReceiverName}
			</if>
			<if test="po.goodReceiverMobile != null">
				and good_receiver_mobile = #{po.goodReceiverMobile}
			</if>
			<if test="po.goodReceiverPhone != null">
				and good_receiver_phone = #{po.goodReceiverPhone}
			</if>
			<if test="po.goodReceiverCountryId != null">
				and good_receiver_country_id = #{po.goodReceiverCountryId}
			</if>
			<if test="po.goodReceiverCountry != null">
				and good_receiver_country = #{po.goodReceiverCountry}
			</if>
			<if test="po.goodReceiverProvinceId != null">
				and good_receiver_province_id = #{po.goodReceiverProvinceId}
			</if>
			<if test="po.goodReceiverProvince != null">
				and good_receiver_province = #{po.goodReceiverProvince}
			</if>
			<if test="po.goodReceiverCityId != null">
				and good_receiver_city_id = #{po.goodReceiverCityId}
			</if>
			<if test="po.goodReceiverCity != null">
				and good_receiver_city = #{po.goodReceiverCity}
			</if>
			<if test="po.goodReceiverCountyId != null">
				and good_receiver_county_id = #{po.goodReceiverCountyId}
			</if>
			<if test="po.goodReceiverCounty != null">
				and good_receiver_county = #{po.goodReceiverCounty}
			</if>
			<if test="po.goodReceiverAreaId != null">
				and good_receiver_area_id = #{po.goodReceiverAreaId}
			</if>
			<if test="po.goodReceiverArea != null">
				and good_receiver_area = #{po.goodReceiverArea}
			</if>
			<if test="po.userId != null">
				and user_id = #{po.userId}
			</if>
			<if test="po.type != null">
				and type = #{po.type}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.isDefault != null">
				and is_default = #{po.isDefault}
			</if>
			<if test="po.modifyMail != null">
				and modify_mail = #{po.modifyMail}
			</if>
		</where>
	</select>

	<select id="findAll" resultMap="receiverAddressMap">
		SELECT
		<include refid="receiverAddressColumns" />
		FROM receiver_address
		<where>
			<if test="po.goodReceiverAddress != null">
				and good_receiver_address = #{po.goodReceiverAddress}
			</if>
			<if test="po.goodReceiverPostcode != null">
				and good_receiver_postcode = #{po.goodReceiverPostcode}
			</if>
			<if test="po.goodReceiverName != null">
				and good_receiver_name = #{po.goodReceiverName}
			</if>
			<if test="po.goodReceiverMobile != null">
				and good_receiver_mobile = #{po.goodReceiverMobile}
			</if>
			<if test="po.goodReceiverPhone != null">
				and good_receiver_phone = #{po.goodReceiverPhone}
			</if>
			<if test="po.goodReceiverCountryId != null">
				and good_receiver_country_id = #{po.goodReceiverCountryId}
			</if>
			<if test="po.goodReceiverCountry != null">
				and good_receiver_country = #{po.goodReceiverCountry}
			</if>
			<if test="po.goodReceiverProvinceId != null">
				and good_receiver_province_id = #{po.goodReceiverProvinceId}
			</if>
			<if test="po.goodReceiverProvince != null">
				and good_receiver_province = #{po.goodReceiverProvince}
			</if>
			<if test="po.goodReceiverCityId != null">
				and good_receiver_city_id = #{po.goodReceiverCityId}
			</if>
			<if test="po.goodReceiverCity != null">
				and good_receiver_city = #{po.goodReceiverCity}
			</if>
			<if test="po.goodReceiverCountyId != null">
				and good_receiver_county_id = #{po.goodReceiverCountyId}
			</if>
			<if test="po.goodReceiverCounty != null">
				and good_receiver_county = #{po.goodReceiverCounty}
			</if>
			<if test="po.goodReceiverAreaId != null">
				and good_receiver_area_id = #{po.goodReceiverAreaId}
			</if>
			<if test="po.goodReceiverArea != null">
				and good_receiver_area = #{po.goodReceiverArea}
			</if>
			<if test="po.userId != null">
				and user_id = #{po.userId}
			</if>
			<if test="po.type != null">
				and type = #{po.type}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.isDefault != null">
				and is_default = #{po.isDefault}
			</if>
			<if test="po.modifyMail != null">
				and modify_mail = #{po.modifyMail}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY id desc
			</otherwise>
		</choose>
	</select>


	<select id="findReceiveDetailBySoId" resultMap="receiverAddressConditionMap">
		SELECT
		sc.id,
		ra.good_receiver_address,
		ra.good_receiver_name,
		ra.good_receiver_mobile,
		ra.good_receiver_country_id,
		ra.good_receiver_country,
		ra.good_receiver_province_id,
		ra.good_receiver_province,
		ra.good_receiver_city_id,
		ra.good_receiver_city,
		ra.good_receiver_county_id,
		ra.good_receiver_county,
		ra.good_receiver_area_id,
		ra.good_receiver_area,
		ra.type,
		ra.create_time,
		ra.update_time,
		ra.modify_mail,
		ra.user_id,
		sp.delivery_date,
		FROM so_child sc
		LEFT JOIN receiver_address ra
		ON sc.delivery_id = ra.id
		LEFT JOIN so_package sp
		ON sc.id = sp.so_child_id
		<where>
			<if test="soId != null">
				and sc.so_id = #{soId}
			</if>
			<if test="platformId != null">
				and sc.platform_id = #{platformId}
			</if>
		</where>
			ORDER BY sc.id
	</select>


	<select id="getUserIdList" resultType="java.lang.Long">
		SELECT DISTINCT user_id FROM receiver_address
		where good_receiver_mobile like concat('%',#{goodReceiverMobile},'%')
	</select>

</mapper>
