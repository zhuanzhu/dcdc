<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.order.dao.write.SoItemWriteDAO">
	<insert id="insert" parameterType="com.egeo.components.order.po.SoItemPO">
		INSERT INTO so_item(
        <trim suffixOverrides=",">
			<if test="soChildId != null">
				so_child_id,
			</if>
			<if test="userId != null">
				user_id,
			</if>
			<if test="unitExist != null">
				unit_exist,
			</if>
			<if test="puId != null">
				pu_id,
			</if>
			<if test="puCount != null">
				pu_count,
			</if>
			<if test="cartType != null">
				cart_type,
			</if>
			<if test="promotionId != null">
				promotion_id,
			</if>
			<if test="price != null">
				price,
			</if>
			<if test="promotionAver != null">
				promotion_aver,
			</if>
			<if test="finalPromotionAver != null">
				final_promotion_aver,
			</if>
			<if test="soId != null">
				so_id,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="platformId != null">
				platform_id,
			</if>
			<if test="puPicUrl != null">
				pu_pic_url,
			</if>
			<if test="puName != null">
				pu_name,
			</if>
			<if test="source != null">
				source,
			</if>
			<if test="snapshot != null">
				snapshot,
			</if>
			<if test="externalSkuId != null">
				external_sku_id,
			</if>
			<if test="afterDiscountPriceAver != null">
				after_discount_price_aver,
			</if>
			<if test="deliveryFeeAver != null">
				delivery_fee_aver,
			</if>
			<if test="storeDiscountAver != null">
				store_discount_aver,
			</if>
			<if test="supplierId != null">
				supplier_id,
			</if>
			<if test="deliveryFeeDiscountAver != null">
				delivery_fee_discount_aver,
			</if>
			<if test="refundCount != null">
				refund_count,
			</if>
			<if test="refundAmount != null">
				refund_amount,
			</if>
			<if test="taxRate != null">
				tax_rate,
			</if>
			<if test="taxCode != null">
				tax_code,
			</if>
			<if test="taxUnit != null">
				tax_unit,
			</if>
			<if test="refundDeliveryFee != null">
				refund_delivery_fee,
			</if>
			<if test="externalProductId != null">
				external_product_id,
			</if>
			<if test="subBizId != null">
				sub_biz_id,
			</if>
		</trim>
		) VALUES (
		<trim suffixOverrides=",">
			<if test="soChildId != null">
				#{soChildId},
			</if>
			<if test="userId != null">
				#{userId},
			</if>
			<if test="unitExist != null">
				#{unitExist},
			</if>
			<if test="puId != null">
				#{puId},
			</if>
			<if test="puCount != null">
				#{puCount},
			</if>
			<if test="cartType != null">
				#{cartType},
			</if>
			<if test="promotionId != null">
				#{promotionId},
			</if>
			<if test="price != null">
				#{price},
			</if>
			<if test="promotionAver != null">
				#{promotionAver},
			</if>
			<if test="finalPromotionAver != null">
				#{finalPromotionAver},
			</if>
			<if test="soId != null">
				#{soId},
			</if>
			<if test="updateTime != null">
				#{updateTime},
			</if>
			<if test="createTime != null">
				#{createTime},
			</if>
			<if test="platformId != null">
				#{platformId},
			</if>
			<if test="puPicUrl != null">
				#{puPicUrl},
			</if>
			<if test="puName != null">
				#{puName},
			</if>
			<if test="source != null">
				#{source},
			</if>
			<if test="snapshot != null">
				#{snapshot},
			</if>
			<if test="externalSkuId != null">
				#{externalSkuId},
			</if>
			<if test="afterDiscountPriceAver != null">
				#{afterDiscountPriceAver},
			</if>
			<if test="deliveryFeeAver != null">
				#{deliveryFeeAver},
			</if>
			<if test="storeDiscountAver != null">
				#{storeDiscountAver},
			</if>
			<if test="supplierId != null">
				#{supplierId},
			</if>
			<if test="deliveryFeeDiscountAver != null">
				#{deliveryFeeDiscountAver},
			</if>
			<if test="refundCount != null">
				#{refundCount},
			</if>
			<if test="refundAmount != null">
				#{refundAmount},
			</if>
			<if test="taxRate != null">
				#{taxRate},
			</if>
			<if test="taxCode != null">
				#{taxCode},
			</if>
			<if test="taxUnit != null">
				#{taxUnit},
			</if>
			<if test="refundDeliveryFee != null">
				#{refundDeliveryFee},
			</if>
			<if test="externalProductId != null">
				#{externalProductId},
			</if>
			<if test="subBizId != null">
				#{subBizId},
			</if>
        </trim>
		)
		<selectKey keyProperty="id" resultType="java.lang.Long">
			select LAST_INSERT_ID()
		</selectKey>
	</insert>




	<update id="update">
	UPDATE so_item
		<set>
			<if test="soChildId != null">
				so_child_id = #{soChildId},
			</if>
			<if test="userId != null">
				user_id = #{userId},
			</if>
			<if test="unitExist != null">
				unit_exist = #{unitExist},
			</if>
			<if test="puId != null">
				pu_id = #{puId},
			</if>
			<if test="puCount != null">
				pu_count = #{puCount},
			</if>
			<if test="cartType != null">
				cart_type = #{cartType},
			</if>
			<if test="promotionId != null">
				promotion_id = #{promotionId},
			</if>
			<if test="price != null">
				price = #{price},
			</if>
			<if test="promotionAver != null">
				promotion_aver = #{promotionAver},
			</if>
			<if test="finalPromotionAver != null">
				final_promotion_aver = #{finalPromotionAver},
			</if>
			<if test="soId != null">
				so_id = #{soId},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime},
			</if>
			<if test="createTime != null">
				create_time = #{createTime},
			</if>
			<if test="platformId != null">
				platform_id = #{platformId},
			</if>
			<if test="puPicUrl != null">
				pu_pic_url=#{puPicUrl},
			</if>
			<if test="puName != null">
				pu_name=#{puName},
			</if>
			<if test="externalSkuId != null">
				external_sku_id=#{externalSkuId},
			</if>
			<if test="afterDiscountPriceAver != null">
				after_discount_price_aver=#{afterDiscountPriceAver},
			</if>
			<if test="deliveryFeeAver != null">
				delivery_fee_aver=#{deliveryFeeAver},
			</if>
			<if test="storeDiscountAver != null">
				store_discount_aver=#{storeDiscountAver},
			</if>
			<if test="deliveryFeeDiscountAver != null">
				delivery_fee_discount_aver=#{deliveryFeeDiscountAver},
			</if>
			<if test="refundCount != null">
				refund_count=#{refundCount},
			</if>
			<if test="refundAmount != null">
				refund_amount=#{refundAmount},
			</if>
			<if test="refundDeliveryFee != null">
				refund_delivery_fee=#{refundDeliveryFee},
			</if>
			<if test="externalProductId != null">
				external_product_id=#{externalProductId},
			</if>
		</set>
		WHERE id = #{id}
	</update>


	<delete id="delete">
		delete from so_item where id = #{id}
	</delete>

	<delete id="deleteByPara">
		delete from so_item
		<where>
			<if test="soChildId != null">
				and so_child_id = #{soChildId}
			</if>
			<if test="userId != null">
				and user_id = #{userId}
			</if>
			<if test="unitExist != null">
				and unit_exist = #{unitExist}
			</if>
			<if test="puId != null">
				and pu_id = #{puId}
			</if>
			<if test="puCount != null">
				and pu_count = #{puCount}
			</if>
			<if test="cartType != null">
				and cart_type = #{cartType}
			</if>
			<if test="promotionId != null">
				and promotion_id = #{promotionId}
			</if>
			<if test="price != null">
				and price = #{price}
			</if>
			<if test="promotionAver != null">
				and promotion_aver = #{promotionAver}
			</if>
			<if test="finalPromotionAver != null">
				and final_promotion_aver = #{finalPromotionAver}
			</if>
			<if test="soId != null">
				and so_id = #{soId}
			</if>
			<if test="updateTime != null">
				and update_time = #{updateTime}
			</if>
			<if test="createTime != null">
				and create_time = #{createTime}
			</if>
			<if test="platformId != null">
				and platform_id = #{platformId}
			</if>
			<if test="puPicUrl != null">
				and pu_pic_url=#{puPicUrl}
			</if>
			<if test="puName != null">
				and pu_name=#{puName}
			</if>
			<if test="externalSkuId != null">
				and external_sku_id=#{externalSkuId}
			</if>
			<if test="externalProductId != null">
				and external_product_id=#{externalProductId}
			</if>
		</where>
	</delete>

	<update id="updateSoItemRefundWithTx" parameterType="com.egeo.components.order.po.SoItemPO">
		update so_item
		set
		<if test="po.refundDeliveryFee !=null">
			refund_delivery_fee=refund_delivery_fee+#{po.refundDeliveryFee},
		</if>
		<if test="po.refundCount !=null">
			refund_count=refund_count+#{po.refundCount},
		</if>
			refund_amount=refund_amount+#{po.refundAmount}
		where id=#{po.id}
	</update>
</mapper>
