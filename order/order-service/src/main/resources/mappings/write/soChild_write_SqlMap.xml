<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.order.dao.write.SoChildWriteDAO">

	<update id="updateDeliveryStatusBySoId">
		update so_child
		set delivery_status=#{deliveryStatus}
		where so_id=#{orderId} and performing_party!=3
	</update>

	<update id="updateDeliveryStatusBySoChildId">
		update so_child
		set delivery_status=#{deliveryStatus}
		where id=#{orderId} and performing_party!=3
	</update>


	<update id="updateSoChildByCodeWithTx" parameterType="com.egeo.components.order.po.SoChildPO">
		update so_child
		set thirdparty_so_child_id=#{po.thirdpartySoChildId},
		delivery_fee=#{po.deliveryFee},
		ordinary_delivery_fee=#{po.ordinaryDeliveryFee},
		thirdparty_so_child_pay_amount=#{po.thirdpartySoChildPayAmount},
		thirdparty_so_child_status=#{po.thirdpartySoChildStatus}
		where child_code=#{po.childCode}
	</update>



	<insert id="insert" parameterType="com.egeo.components.order.po.SoChildPO">
		INSERT INTO so_child(
		<trim suffixOverrides=",">
			<if test="childCode != null">
				child_code,
			</if>
			<if test="ordinaryId != null">
				ordinary_id,
			</if>
			<if test="depotId != null">
				depot_id,
			</if>
			<if test="soId != null">
				so_id,
			</if>
			<if test="amount != null">
				amount,
			</if>
			<if test="source != null">
				source,
			</if>
			<if test="deliveryId != null">
				delivery_id,
			</if>
			<if test="refundAmount != null">
				refund_amount,
			</if>
			<if test="refundType != null">
				refund_type,
			</if>
			<if test="modifyAddressTime != null">
				modify_address_time,
			</if>
			<if test="modifiedAddress != null">
				modified_address,
			</if>
			<if test="receiverAddressId != null">
				receiver_address_id,
			</if>
			<if test="deliveryStatus != null">
				delivery_status,
			</if>
			<if test="performingParty != null">
				performing_party,
			</if>
			<if test="invoiceId != null">
				invoice_id,
			</if>
			<if test="invoiceAmount != null">
				invoice_amount,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
			<if test="lastOperatorId != null">
				last_operator_id,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="platformId != null">
				platform_id,
			</if>
			<if test="lastOperateTime != null">
				last_operate_time,
			</if>
			<if test="thirdpartyType != null">
				thirdparty_type,
			</if>
			<if test="preSell!=null">
				pre_sell,
			</if>
			<if test="deliverEndTime!=null">
				deliver_end_time,
			</if>
			<if test="deliveryFee!=null">
				delivery_fee,
			</if>
			<if test="needCountDeliveryFee!=null">
				need_count_delivery_fee,
			</if>
			<if test="productAmount!=null">
				product_amount,
			</if>
			<if test="deliveryFeeDiscount!=null">
				delivery_fee_discount,
			</if>
			<if test="couponDiscount!=null">
				coupon_discount,
			</if>
			<if test="storeDiscount!=null">
				store_discount,
			</if>
			<if test="couponId!=null">
				coupon_id,
			</if>
			<if test="deliveryCouponId!=null">
				delivery_coupon_id,
			</if>
			<if test="ordinaryDeliveryFee!=null">
				ordinary_delivery_fee,
			</if>
			<if test="thirdpartySoChildId!=null">
				thirdparty_so_child_id,
			</if>
			<if test="thirdpartySoChildPayAmount!=null">
				thirdparty_so_child_pay_amount,
			</if>
			<if test="supplierId!=null">
				supplier_id,
			</if>
			<if test="thirdpartySoChildCode!=null">
				thirdparty_so_child_code,
			</if>
			<if test="thirdpatyDiscountAmount!=null">
				thirdpaty_discount_amount,
			</if>
			<if test="refundDeliveryFee !=null">
				refund_delivery_fee,
			</if>
			<if test="ext !=null">
				ext,
			</if>
			<if test="cancelStatus !=null">
				cancel_status,
			</if>
		</trim>
		) VALUES (
		<trim suffixOverrides=",">
			<if test="childCode != null">
				#{childCode},
			</if>
			<if test="ordinaryId != null">
				#{ordinaryId},
			</if>
			<if test="depotId != null">
				#{depotId},
			</if>
			<if test="soId != null">
				#{soId},
			</if>
			<if test="amount != null">
				#{amount},
			</if>
			<if test="source != null">
				#{source},
			</if>
			<if test="deliveryId != null">
				#{deliveryId},
			</if>
			<if test="refundAmount != null">
				#{refundAmount},
			</if>
			<if test="refundType != null">
				#{refundType},
			</if>
			<if test="modifyAddressTime != null">
				#{modifyAddressTime},
			</if>
			<if test="modifiedAddress != null">
				#{modifiedAddress},
			</if>
			<if test="receiverAddressId != null">
				#{receiverAddressId},
			</if>
			<if test="deliveryStatus != null">
				#{deliveryStatus},
			</if>
			<if test="performingParty != null">
				#{performingParty},
			</if>
			<if test="invoiceId != null">
				#{invoiceId},
			</if>
			<if test="invoiceAmount != null">
				#{invoiceAmount},
			</if>
			<if test="createTime != null">
				#{createTime},
			</if>
			<if test="updateTime != null">
				#{updateTime},
			</if>
			<if test="lastOperatorId != null">
				#{lastOperatorId},
			</if>
			<if test="remark != null">
				#{remark},
			</if>
			<if test="platformId != null">
				#{platformId},
			</if>
			<if test="lastOperateTime != null">
				#{lastOperateTime},
			</if>
			<if test="thirdpartyType != null">
				#{thirdpartyType},
			</if>
			<if test="preSell!=null">
				#{preSell},
			</if>
			<if test="deliverEndTime!=null">
				#{deliverEndTime},
			</if>
			<if test="deliveryFee!=null">
				#{deliveryFee},
			</if>
			<if test="needCountDeliveryFee!=null">
				#{needCountDeliveryFee},
			</if>
			<if test="productAmount!=null">
				#{productAmount},
			</if>
			<if test="deliveryFeeDiscount!=null">
				#{deliveryFeeDiscount},
			</if>
			<if test="couponDiscount!=null">
				#{couponDiscount},
			</if>
			<if test="storeDiscount!=null">
				#{storeDiscount},
			</if>
			<if test="couponId!=null">
				#{couponId},
			</if>
			<if test="deliveryCouponId!=null">
				#{deliveryCouponId},
			</if>
			<if test="ordinaryDeliveryFee!=null">
				#{ordinaryDeliveryFee},
			</if>
			<if test="thirdpartySoChildId!=null">
				#{thirdpartySoChildId},
			</if>
			<if test="thirdpartySoChildPayAmount!=null">
				#{thirdpartySoChildPayAmount},
			</if>
			<if test="supplierId!=null">
				#{supplierId},
			</if>
			<if test="thirdpartySoChildCode!=null">
				#{thirdpartySoChildCode},
			</if>
			<if test="thirdpatyDiscountAmount!=null">
				#{thirdpatyDiscountAmount},
			</if>
			<if test="refundDeliveryFee !=null">
				#{refundDeliveryFee},
			</if>
			<if test="ext !=null">
				#{ext},
			</if>
			<if test="cancelStatus !=null">
				#{cancelStatus},
			</if>
		</trim>
		)
		<selectKey keyProperty="id" resultType="java.lang.Long">
			select
			LAST_INSERT_ID()
		</selectKey>
	</insert>




	<update id="update">
		UPDATE so_child
		<set>
			<if test="childCode != null">
				child_code=#{childCode},
			</if>
			<if test="ordinaryId != null">
				ordinary_id = #{ordinaryId},
			</if>
			<if test="depotId != null">
				depot_id = #{depotId},
			</if>
			<if test="soId != null">
				so_id = #{soId},
			</if>
			<if test="amount != null">
				amount = #{amount},
			</if>
			<if test="deliveryId != null">
				delivery_id = #{deliveryId},
			</if>
			<if test="refundAmount != null">
				refund_amount = #{refundAmount},
			</if>
			<if test="refundType != null">
				refund_type = #{refundType},
			</if>
			<if test="modifyAddressTime != null">
				modify_address_time = #{modifyAddressTime},
			</if>
			<if test="modifiedAddress != null">
				modified_address = #{modifiedAddress},
			</if>
			<if test="receiverAddressId != null">
				receiver_address_id = #{receiverAddressId},
			</if>
			<if test="deliveryStatus != null">
				delivery_status = #{deliveryStatus},
			</if>
			<if test="performingParty != null">
				performing_party = #{performingParty},
			</if>
			<if test="invoiceId != null">
				invoice_id = #{invoiceId},
			</if>
			<if test="invoiceAmount != null">
				invoice_amount = #{invoiceAmount},
			</if>
			<if test="createTime != null">
				create_time = #{createTime},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime},
			</if>
			<if test="lastOperatorId != null">
				last_operator_id = #{lastOperatorId},
			</if>
			<if test="remark != null">
				remark = #{remark},
			</if>
			<if test="platformId != null">
				platform_id = #{platformId},
			</if>
			<if test="lastOperateTime != null">
				last_operate_time=#{lastOperateTime},
			</if>
			<if test="thirdpartyType != null">
				thirdparty_type=#{thirdpartyType},
			</if>
			<if test="preSell!=null">
				pre_sell=#{preSell},
			</if>
			<if test="deliverEndTime!=null">
				deliver_end_time=#{deliverEndTime},
			</if>
			<if test="deliveryFee!=null">
				delivery_fee=#{deliveryFee},
			</if>
			<if test="needCountDeliveryFee!=null">
				need_count_delivery_fee=#{needCountDeliveryFee},
			</if>
			<if test="productAmount!=null">
				product_amount=#{productAmount},
			</if>
			<if test="deliveryFeeDiscount!=null">
				delivery_fee_discount=#{deliveryFeeDiscount},
			</if>
			<if test="couponDiscount!=null">
				coupon_discount=#{couponDiscount},
			</if>
			<if test="storeDiscount!=null">
				store_discount=#{storeDiscount},
			</if>
			<if test="couponId!=null">
				coupon_id=#{couponId},
			</if>
			<if test="deliveryCouponId!=null">
				delivery_coupon_id=#{deliveryCouponId},
			</if>
			<if test="ordinaryDeliveryFee!=null">
				ordinary_delivery_fee=#{ordinaryDeliveryFee},
			</if>
			<if test="thirdpartySoChildId !=null">
				thirdparty_so_child_id=#{thirdpartySoChildId},
			</if>
			<if test="thirdpartySoChildStatus !=null">
				thirdparty_so_child_status=#{thirdpartySoChildStatus},
			</if>
			<if test="thirdpartySoChildPayAmount !=null">
				thirdparty_so_child_pay_amount=#{thirdpartySoChildPayAmount},
			</if>
			<if test="refundDeliveryFee !=null">
				refund_delivery_fee=#{refundDeliveryFee},
			</if>
			<if test="ext !=null">
				ext=#{ext},
			</if>
			<if test="cancelStatus !=null">
				cancel_status=#{cancelStatus},
			</if>
		</set>
		WHERE id = #{id}
	</update>


	<delete id="delete">
		delete from so_child where id = #{id}
	</delete>

	<delete id="deleteByPara">
		delete from so_child
		<where>
			<if test="childCode != null">
				and child_code=#{childCode}
			</if>
			<if test="ordinaryId != null">
				and ordinary_id = #{ordinaryId}
			</if>
			<if test="depotId != null">
				and depot_id = #{depotId}
			</if>
			<if test="soId != null">
				and so_id = #{soId}
			</if>
			<if test="amount != null">
				and amount = #{amount}
			</if>
			<if test="deliveryId != null">
				and delivery_id = #{deliveryId}
			</if>
			<if test="refundAmount != null">
				and refund_amount = #{refundAmount}
			</if>
			<if test="refundType != null">
				and refund_type = #{refundType}
			</if>
			<if test="modifyAddressTime != null">
				and modify_address_time = #{modifyAddressTime}
			</if>
			<if test="modifiedAddress != null">
				and modified_address = #{modifiedAddress}
			</if>
			<if test="receiverAddressId != null">
				and receiver_address_id = #{receiverAddressId}
			</if>
			<if test="deliveryStatus != null">
				and delivery_status = #{deliveryStatus}
			</if>
			<if test="performingParty != null">
				and performing_party = #{performingParty}
			</if>
			<if test="invoiceId != null">
				and invoice_id = #{invoiceId}
			</if>
			<if test="invoiceAmount != null">
				and invoice_amount = #{invoiceAmount}
			</if>
			<if test="createTime != null">
				and create_time = #{createTime}
			</if>
			<if test="updateTime != null">
				and update_time = #{updateTime}
			</if>
			<if test="lastOperatorId != null">
				and last_operator_id = #{lastOperatorId}
			</if>
			<if test="remark != null">
				and remark = #{remark}
			</if>
			<if test="platformId != null">
				and platform_id = #{platformId}
			</if>
			<if test="lastOperateTime != null">
				and last_operate_time=#{lastOperateTime}
			</if>
			<if test="thirdpartyType != null">
				and thirdparty_type = #{thirdpartyType}
			</if>
			<if test="preSell!=null">
				AND pre_sell=#{preSell}
			</if>
			<if test="cancelStatus !=null">
				and cancel_status=#{cancelStatus}
			</if>
		</where>
	</delete>

	<update id="updateSoChildRefundWithTx" parameterType="com.egeo.components.order.po.SoChildPO">
		update so_child
		set
		<if test="po.refundDeliveryFee !=null">
			refund_delivery_fee=refund_delivery_fee+#{po.refundDeliveryFee},
		</if>
		<if test="po.thirdpartySoChildStatus !=null">
			thirdparty_so_child_status=#{po.thirdpartySoChildStatus},
		</if>
		<if test="po.deliveryStatus !=null">
			delivery_status=#{po.deliveryStatus},
		</if>
		<if test="po.cancelStatus !=null">
			cancel_status=#{po.cancelStatus},
		</if>
			refund_amount=refund_amount+#{po.refundAmount}
		where id=#{po.id}
	</update>

	<update id="deleteByChildCodeWithTx">
		update so_child
		set child_delete_status=#{deleteStatus}
		where child_code=#{childCode}
	</update>
</mapper>
