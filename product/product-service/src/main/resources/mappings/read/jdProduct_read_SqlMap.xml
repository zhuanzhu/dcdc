<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.product.dao.read.JdProductReadDAO">
	<resultMap type="com.egeo.components.product.po.JdProductPO" id="jdProductMap">
		<result property="id" column="id" />
		<result property="categoryId" column="category_id" />
		<result property="name" column="name" />
		<result property="imagePath" column="image_path" />
		<result property="introduction" column="introduction" />
		<result property="param" column="param" />
		<result property="lowestBuy" column="lowest_buy" />
		<result property="spuId" column="spu_id" />
		<result property="spuName" column="spu_name" />
		<result property="price" column="price" />
		<result property="marketPrice" column="market_price" />
		<result property="isSelf" column="is_self" />
		<result property="isJdLogistics" column="is_jd_logistics" />
		<result property="saleState" column="sale_state" />
		<result property="state" column="state" />
		<result property="is7ToReturn" column="is7_to_return" />
		<result property="noReasonToReturn" column="no_reason_to_return" />
		<result property="thwa" column="thwa" />
		<result property="skuJson" column="sku_json" />
		<result property="syncStatus" column="sync_status" />
		<result property="profit" column="profit" />
		<result property="isShow" column="is_show" />
		<result property="isDetail" column="is_detail" />
		<result property="syncTime" column="sync_time" />
		<result property="productCreateTime" column="product_create_time" />
		<result property="picture" column="picture" />
	</resultMap>

	<sql id="jdProductColumns">
		id,
		category_id,
		name,
		image_path,
		introduction,
		param,
		lowest_buy,
		spu_id,
		spu_name,
		price,
		market_price,
		is_self,
		is_jd_logistics,
		sale_state,
		state,
		is7_to_return,
		no_reason_to_return,
		thwa,
		sku_json,
		sync_status,
		profit,
		is_show,
		is_detail,
		sync_time,
		product_create_time,
		picture
	</sql>

	<select id="findById" parameterType="com.egeo.components.product.po.JdProductPO" resultMap="jdProductMap">
		SELECT
		<include refid="jdProductColumns" />
		FROM jd_product
		WHERE id = #{po.id}
	</select>



	<select id="findHavedIdListByIdList"  resultType="java.lang.Long">
		SELECT
		id
		FROM jd_product
		WHERE id IN (
		<foreach collection="ids" item="id" separator=",">
			#{id}
		</foreach>
		)

	</select>

	<select id="findOfPage" resultMap="jdProductMap">
		SELECT
		<include refid="jdProductColumns" />
		FROM jd_product
		<where>
			<if test="po.categoryId != null">
				and category_id = #{po.categoryId}
			</if>
			<if test="po.name != null">
				and name = #{po.name}
			</if>
			<if test="po.imagePath != null">
				and image_path = #{po.imagePath}
			</if>
			<if test="po.introduction != null">
				and introduction = #{po.introduction}
			</if>
			<if test="po.param != null">
				and param = #{po.param}
			</if>
			<if test="po.lowestBuy != null">
				and lowest_buy = #{po.lowestBuy}
			</if>
			<if test="po.spuId != null">
				and spu_id = #{po.spuId}
			</if>
			<if test="po.spuName != null">
				and spu_name = #{po.spuName}
			</if>
			<if test="po.price != null">
				and price = #{po.price}
			</if>
			<if test="po.marketPrice != null">
				and market_price = #{po.marketPrice}
			</if>
			<if test="po.isSelf != null">
				and is_self = #{po.isSelf}
			</if>
			<if test="po.isJdLogistics != null">
				and is_jd_logistics = #{po.isJdLogistics}
			</if>
			<if test="po.saleState != null">
				and sale_state = #{po.saleState}
			</if>
			<if test="po.state != null">
				and state = #{po.state}
			</if>
			<if test="po.is7ToReturn != null">
				and is7_to_return = #{po.is7ToReturn}
			</if>
			<if test="po.noReasonToReturn != null">
				and no_reason_to_return = #{po.noReasonToReturn}
			</if>
			<if test="po.thwa != null">
				and thwa = #{po.thwa}
			</if>
			<if test="po.skuJson != null">
				and sku_json = #{po.skuJson}
			</if>
			<if test="po.syncStatus != null">
				and sync_status = #{po.syncStatus}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>		
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
		<if test="page != null">
		limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>
	
	<select id="countOfPage" resultType="java.lang.Integer">
		SELECT
		count(1) cnt
		FROM jd_product
		<where>
			<if test="po.categoryId != null">
				and category_id = #{po.categoryId}
			</if>
			<if test="po.name != null">
				and name = #{po.name}
			</if>
			<if test="po.imagePath != null">
				and image_path = #{po.imagePath}
			</if>
			<if test="po.introduction != null">
				and introduction = #{po.introduction}
			</if>
			<if test="po.param != null">
				and param = #{po.param}
			</if>
			<if test="po.lowestBuy != null">
				and lowest_buy = #{po.lowestBuy}
			</if>
			<if test="po.spuId != null">
				and spu_id = #{po.spuId}
			</if>
			<if test="po.spuName != null">
				and spu_name = #{po.spuName}
			</if>
			<if test="po.price != null">
				and price = #{po.price}
			</if>
			<if test="po.marketPrice != null">
				and market_price = #{po.marketPrice}
			</if>
			<if test="po.isSelf != null">
				and is_self = #{po.isSelf}
			</if>
			<if test="po.isJdLogistics != null">
				and is_jd_logistics = #{po.isJdLogistics}
			</if>
			<if test="po.saleState != null">
				and sale_state = #{po.saleState}
			</if>
			<if test="po.state != null">
				and state = #{po.state}
			</if>
			<if test="po.is7ToReturn != null">
				and is7_to_return = #{po.is7ToReturn}
			</if>
			<if test="po.noReasonToReturn != null">
				and no_reason_to_return = #{po.noReasonToReturn}
			</if>
			<if test="po.thwa != null">
				and thwa = #{po.thwa}
			</if>
			<if test="po.skuJson != null">
				and sku_json = #{po.skuJson}
			</if>
			<if test="po.syncStatus != null">
				and sync_status = #{po.syncStatus}
			</if>
		</where>
	</select>
	
	<select id="findAll" resultMap="jdProductMap">
		SELECT
		<include refid="jdProductColumns" />
		FROM jd_product
		<where>
			<if test="po.categoryId != null">
				and category_id = #{po.categoryId}
			</if>
			<if test="po.name != null">
				and name = #{po.name}
			</if>
			<if test="po.imagePath != null">
				and image_path = #{po.imagePath}
			</if>
			<if test="po.introduction != null">
				and introduction = #{po.introduction}
			</if>
			<if test="po.param != null">
				and param = #{po.param}
			</if>
			<if test="po.lowestBuy != null">
				and lowest_buy = #{po.lowestBuy}
			</if>
			<if test="po.spuId != null">
				and spu_id = #{po.spuId}
			</if>
			<if test="po.spuName != null">
				and spu_name = #{po.spuName}
			</if>
			<if test="po.price != null">
				and price = #{po.price}
			</if>
			<if test="po.marketPrice != null">
				and market_price = #{po.marketPrice}
			</if>
			<if test="po.isSelf != null">
				and is_self = #{po.isSelf}
			</if>
			<if test="po.isJdLogistics != null">
				and is_jd_logistics = #{po.isJdLogistics}
			</if>
			<if test="po.saleState != null">
				and sale_state = #{po.saleState}
			</if>
			<if test="po.state != null">
				and state = #{po.state}
			</if>
			<if test="po.is7ToReturn != null">
				and is7_to_return = #{po.is7ToReturn}
			</if>
			<if test="po.noReasonToReturn != null">
				and no_reason_to_return = #{po.noReasonToReturn}
			</if>
			<if test="po.thwa != null">
				and thwa = #{po.thwa}
			</if>
			<if test="po.skuJson != null">
				and sku_json = #{po.skuJson}
			</if>
			<if test="po.syncStatus != null">
				and sync_status = #{po.syncStatus}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>			
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
	</select>


	<select id="findAllIdList" resultType="java.lang.Long">
		SELECT
		id
		FROM jd_product
	</select>

	<select id="findJdProductListByIds" resultMap="jdProductMap">
		SELECT
		*
		FROM jd_product
		WHERE
		id IN
		<foreach collection="ids" item="id" open="(" close=")" separator=",">
			#{id}
		</foreach>
	</select>

	<select id="getJdProductListByParamsCount" resultType="java.lang.Integer">
	SELECT
	count(1)
	FROM jd_product
	<where>
		<if test="skuId != null">
			and id = #{skuId}
		</if>

		<if test="skuNameList != null">
			<foreach collection="skuNameList" item="skuName" >
				AND name like concat(concat('%',#{skuName}),'%')
			</foreach>
		</if>
		<if test="updateTimeStart !=null ">
			and update_time <![CDATA[>=]]>#{updateTimeStart}
		</if>
		<if test="updateTimeEnd !=null ">
			and update_time <![CDATA[<=]]>#{updateTimeEnd}
		</if>
		<if test="profitStart !=null ">
			and profit <![CDATA[>=]]>#{profitStart}
		</if>
		<if test="profitEnd !=null ">
			and profit <![CDATA[<=]]>#{profitEnd}
		</if>
		<if test="sycStatus !=null ">
			and sync_status= #{sycStatus}
		</if>
		<if test="catId !=null ">
			and category_id= #{catId}
		</if>
		<if test="isShow !=null ">
			and is_show= #{isShow}
		</if>
		<if test="state !=null ">
			and state= #{state}
		</if>
	</where>
	</select>

	<select id="getJdProductListByParams" resultMap="jdProductMap">
		SELECT
		*
		FROM jd_product
		<where>
			<if test="skuId != null">
				and id = #{skuId}
			</if>

			<if test="skuNameList != null">
				<foreach collection="skuNameList" item="skuName" >
					AND name like concat(concat('%',#{skuName}),'%')
				</foreach>
			</if>
			<if test="updateTimeStart !=null ">
				and update_time <![CDATA[>=]]>#{updateTimeStart}
			</if>
		<if test="updateTimeEnd !=null ">
				and update_time <![CDATA[<=]]>#{updateTimeEnd}
			</if>
		<if test="profitStart !=null ">
				and profit <![CDATA[>=]]>#{profitStart}
			</if>
		<if test="profitEnd !=null ">
			and profit <![CDATA[<=]]>#{profitEnd}
		</if>
		<if test="sycStatus !=null ">
			and sync_status= #{sycStatus}
		</if>
		<if test="catId !=null ">
			and category_id= #{catId}
		</if>
		<if test="isShow !=null ">
			and is_show= #{isShow}
		</if>
			<if test="state !=null ">
			and state= #{state}
		</if>
		</where>


		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY id desc
			</otherwise>
		</choose>
		<if test="page != null">
			limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>

	<select id="findJdProductCountByProfit" resultType="java.lang.Integer">
		SELECT
		count(1)
		FROM jd_product
		WHERE
		profit>=#{profit}
		AND
		product_create_time is NULL
	</select>
	<select id="findJdProductListByProfit" resultMap="jdProductMap">
		SELECT
		*
		FROM jd_product
		WHERE
		profit>=#{profit}
		AND
		product_create_time is NULL
		limit #{start},#{pageSize}
	</select>
</mapper>
	