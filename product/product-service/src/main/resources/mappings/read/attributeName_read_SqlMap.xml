<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.product.dao.read.AttributeNameReadDAO">
	<select id="queryAttributeNamesByIds" resultMap="attributeNameMap">
		select * from attribute_name
		where id 
		<include refid="inClause" />
	</select>

	<sql id="inClause">
		in
		<foreach collection="ids" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</sql>

	<resultMap type="com.egeo.components.product.po.AttributeNamePO" id="attributeNameMap">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="specificationProperty" column="specification_property" />
		<result property="parameterProperty" column="parameter_property" />
		<result property="platformId" column="platform_id" />
		<result property="mode" column="mode" />
		<result property="createTime" column="create_time" />
		<result property="updateTime" column="update_time" />
		<result property="beginDecimal" column="begin_decimal" />
		<result property="finishDecimal" column="finish_decimal" />
		<result property="unit" column="unit" />
		<result property="importHint" column="import_hint" />
	</resultMap>
	
	<sql id="attributeNameColumns">
		id,
		name,
		specification_property,
		parameter_property,
		platform_id,
		mode,
		create_time,
		update_time
	</sql>

	<select id="findById" parameterType="com.egeo.components.product.po.AttributeNamePO" resultMap="attributeNameMap">
		SELECT
		<include refid="attributeNameColumns" />
		FROM attribute_name
		WHERE id = #{po.id}
	</select>

	<select id="findOfPage" resultMap="attributeNameMap">
		SELECT
		<include refid="attributeNameColumns" />
		FROM attribute_name
		<where>
			<if test="po.id != null">
				and id =  #{po.id}
			</if>
			<if test="po.name != null">
				and name like concat('%',#{po.name},'%') 
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.specificationProperty != null">
				and specification_property = #{po.specificationProperty}
			</if>
			<if test="po.parameterProperty != null">
				and parameter_property = #{po.parameterProperty}
			</if>
			<if test="po.mode != null">
				and mode = #{po.mode}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>		
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
		<if test="page != null">
		limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>
	
	<select id="countOfPage" resultType="java.lang.Integer">
		SELECT
		count(1) cnt
		FROM attribute_name
		<where>
			<if test="po.id != null">
				and id =  #{po.id}
			</if>
			<if test="po.name != null">
				and name like concat('%',#{po.name},'%') 
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.specificationProperty != null">
				and specification_property = #{po.specificationProperty}
			</if>
			<if test="po.parameterProperty != null">
				and parameter_property = #{po.parameterProperty}
			</if>
			<if test="po.mode != null">
				and mode = #{po.mode}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
		</where>
	</select>
	
	<select id="findAll" resultMap="attributeNameMap">
		SELECT
		<include refid="attributeNameColumns" />
		FROM attribute_name
		<where>
			<if test="po.name != null">
				and name like concat('%',#{po.name},'%') 
			</if>
			<if test="po.specificationProperty != null">
				and specification_property = #{po.specificationProperty}
			</if>
			<if test="po.parameterProperty != null">
				and parameter_property = #{po.parameterProperty}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
			<if test="po.mode != null">
				and mode = #{po.mode}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>			
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
	</select>
	
	<select id="findByIds" resultMap="attributeNameMap">
		SELECT
		<include refid="attributeNameColumns" />
		FROM attribute_name
		<where>
			<if test="ids != null">
				and id not in(${ids})
			</if>
			<if test="specificationProperty != null">
				and specification_property = ${specificationProperty}
			</if>
			<if test="parameterProperty != null">
				and parameter_property = ${parameterProperty}
			</if>
			<if test="name != null">
				and name like concat('%',#{name},'%')
			</if>
		</where>
	</select>
	
	<select id="findByCategoryId" resultMap="attributeNameMap">
		SELECT
		an.id,
		an.name,
		an.specification_property,
		an.parameter_property,
		an.platform_id,
		an.mode,
		an.create_time,
		an.update_time
		FROM attribute_name an
		LEFT JOIN category_att_name can on can.att_name_id = an.id
		WHERE can.type = 2 and can.category_id = #{categoryId}
	</select>
	
	<select id="findByProductId" resultMap="attributeNameMap">
		SELECT
		an.id,
		an.name,
		an.specification_property,
		an.parameter_property,
		an.platform_id,
		an.mode,
		an.create_time,
		an.update_time
		FROM attribute_name an
		LEFT JOIN product_att_name pan on pan.att_name_id = an.id
		WHERE pan.type = 2 and pan.product_id = #{productId}
	</select>
	
	<select id="findByAttributeNameId" resultMap="attributeNameMap">
		SELECT
		an.id,
		an.name,
		an.specification_property,
		an.parameter_property,
		an.platform_id,
		an.mode,
		an.create_time,
		an.update_time,
		attnd.begin_decimal,
		attnd.finish_decimal,
		attnd.unit,
		attnd.import_hint
		FROM attribute_name an
		LEFT JOIN attribute_name_decimal attnd on attnd.attribute_name_id = an.id
		WHERE an.id = #{po.id}
	</select>
	
	<select id="findByAttName" resultMap="attributeNameMap">
		SELECT
		<include refid="attributeNameColumns" />
		FROM attribute_name
		WHERE name = #{name}
	</select>
</mapper>
	