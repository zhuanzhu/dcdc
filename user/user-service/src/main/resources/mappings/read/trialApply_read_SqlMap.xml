<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.user.dao.read.TrialApplyReadDAO">
	<resultMap type="com.egeo.components.user.po.TrialApplyPO" id="trialApplyMap">
		<result property="id" column="id" />
		<result property="companyName" column="company_name" />
		<result property="companyScale" column="company_scale" />
		<result property="userName" column="user_name" />
		<result property="phone" column="phone" />
		<result property="position" column="position" />
		<result property="mail" column="mail" />
		<result property="message" column="message" />
		<result property="clientType" column="client_type" />
		<result property="status" column="status" />
		<result property="dealUser" column="deal_user" />
		<result property="dealTime" column="deal_time" />
		<result property="createTime" column="create_time" />
		<result property="updateTime" column="update_time" />
		<result property="platformId" column="platform_id" />
	</resultMap>

	<sql id="trialApplyColumns">
		id,
		company_name,
		company_scale,
		user_name,
		phone,
		position,
		mail,
		message,
		client_type,
		status,
		deal_user,
		deal_time,
		create_time,
		update_time,
		platform_id
	</sql>

	<select id="findById" parameterType="com.egeo.components.user.po.TrialApplyPO" resultMap="trialApplyMap">
		SELECT
		<include refid="trialApplyColumns" />
		FROM trial_apply
		WHERE id = #{po.id}
	</select>

	<select id="findOfPage" resultMap="trialApplyMap">
		SELECT
		<include refid="trialApplyColumns" />
		FROM trial_apply
		<where>
			<if test="po.companyName != null">
				and company_name = #{po.companyName}
			</if>
			<if test="po.companyScale != null">
				and company_scale = #{po.companyScale}
			</if>
			<if test="po.userName != null">
				and user_name = #{po.userName}
			</if>
			<if test="po.phone != null">
				and phone = #{po.phone}
			</if>
			<if test="po.position != null">
				and position = #{po.position}
			</if>
			<if test="po.mail != null">
				and mail = #{po.mail}
			</if>
			<if test="po.message != null">
				and message = #{po.message}
			</if>
			<if test="po.clientType != null">
				and client_type = #{po.clientType}
			</if>
			<if test="po.status != null">
				and status = #{po.status}
			</if>
			<if test="po.dealUser != null">
				and deal_user = #{po.dealUser}
			</if>
			<if test="po.dealTime != null">
				and deal_time = #{po.dealTime}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>		
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
		<if test="page != null">
		limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>
	
	<select id="countOfPage" resultType="java.lang.Integer">
		SELECT
		count(1) cnt
		FROM trial_apply
		<where>
			<if test="po.companyName != null">
				and company_name = #{po.companyName}
			</if>
			<if test="po.companyScale != null">
				and company_scale = #{po.companyScale}
			</if>
			<if test="po.userName != null">
				and user_name = #{po.userName}
			</if>
			<if test="po.phone != null">
				and phone = #{po.phone}
			</if>
			<if test="po.position != null">
				and position = #{po.position}
			</if>
			<if test="po.mail != null">
				and mail = #{po.mail}
			</if>
			<if test="po.message != null">
				and message = #{po.message}
			</if>
			<if test="po.clientType != null">
				and client_type = #{po.clientType}
			</if>
			<if test="po.status != null">
				and status = #{po.status}
			</if>
			<if test="po.dealUser != null">
				and deal_user = #{po.dealUser}
			</if>
			<if test="po.dealTime != null">
				and deal_time = #{po.dealTime}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>			
		</where>
	</select>
	
	<sql id="pageByBlurry">
		FROM trial_apply ta 
		left join u_user u on u.id = ta.deal_user 
			<where>
				<if test="po.companyName != null">
					and ta.company_name like concat('%',#{po.companyName},'%') 
				</if>
				<if test="po.companyScale != null">
					and ta.company_scale = #{po.companyScale}
				</if>
				<if test="po.userName != null">
					and ta.user_name = #{po.userName}
				</if>
				<if test="po.phone != null">
					and ta.phone = #{po.phone}
				</if>
				<if test="po.position != null">
					and ta.position = #{po.position}
				</if>
				<if test="po.mail != null">
					and ta.mail = #{po.mail}
				</if>
				<if test="po.message != null">
					and ta.message = #{po.message}
				</if>
				<if test="po.clientType != null">
					and ta.client_type = #{po.clientType}
				</if>
				<if test="po.status != null">
					and ta.status = #{po.status}
				</if>
				<if test="po.dealUser != null">
					and ta.deal_user = #{po.dealUser}
				</if>
				<if test="po.dealTime != null">
					and ta.deal_time = #{po.dealTime}
				</if>
				<if test="po.createTime != null">
					and date_format(ta.create_time,'%y-%m-%d') = date_format(#{po.createTime},'%y-%m-%d')
				</if>
				<if test="po.updateTime != null">
					and ta.update_time = #{po.updateTime}
				</if>
				<if test="po.platformId != null">
					and platform_id = #{po.platformId}
				</if>	
			</where>
	</sql>
	
	<select id="findOfPageByBlurry" resultMap="trialApplyMap">
		SELECT
		ta.*,
		u.login_name dealUserName 
		<include refid="pageByBlurry"></include> 
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy} 
			</when>		
			<otherwise>
				ORDER BY ta.id desc 
			</otherwise>
		</choose>
		<if test="page != null">
		limit #{page.limitStart},#{page.pageSize}
		</if>
	</select>
	
	<select id="countOfPageByBlurry" resultType="java.lang.Integer">
		SELECT
		count(1) cnt
		<include refid="pageByBlurry"></include>
	</select>
	
	<select id="findAll" resultMap="trialApplyMap">
		SELECT
		<include refid="trialApplyColumns" />
		FROM trial_apply
		<where>
			<if test="po.companyName != null">
				and company_name = #{po.companyName}
			</if>
			<if test="po.companyScale != null">
				and company_scale = #{po.companyScale}
			</if>
			<if test="po.userName != null">
				and user_name = #{po.userName}
			</if>
			<if test="po.phone != null">
				and phone = #{po.phone}
			</if>
			<if test="po.position != null">
				and position = #{po.position}
			</if>
			<if test="po.mail != null">
				and mail = #{po.mail}
			</if>
			<if test="po.message != null">
				and message = #{po.message}
			</if>
			<if test="po.clientType != null">
				and client_type = #{po.clientType}
			</if>
			<if test="po.status != null">
				and status = #{po.status}
			</if>
			<if test="po.dealUser != null">
				and deal_user = #{po.dealUser}
			</if>
			<if test="po.dealTime != null">
				and deal_time = #{po.dealTime}
			</if>
			<if test="po.createTime != null">
				and create_time = #{po.createTime}
			</if>
			<if test="po.updateTime != null">
				and update_time = #{po.updateTime}
			</if>
			<if test="po.platformId != null">
				and platform_id = #{po.platformId}
			</if>
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>			
			<otherwise>
				ORDER BY id desc		
			</otherwise>
		</choose>
	</select>
</mapper>
	