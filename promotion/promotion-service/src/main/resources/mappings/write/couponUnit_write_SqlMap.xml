<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.egeo.components.promotion.dao.write.CouponUnitWriteDAO">
	<insert id="insert" parameterType="com.egeo.components.promotion.po.CouponUnitPO">
		INSERT INTO coupon_unit(
        <trim suffixOverrides=",">
			<if test="receivedTime != null">
				received_time,
			</if>
			<if test="couponUnitCode != null">
				coupon_unit_code,
			</if>

			<if test="couponId != null">
				coupon_id,
			</if>
			<if test="couponBatchId != null">
				coupon_batch_id,
			</if>
			<if test="orderId != null">
				order_id,
			</if>
			<if test="userId != null">
				user_id,
			</if>
			<if test="usedTime != null">
				used_time,
			</if>
			<if test="usedCount != null">
				used_count,
			</if>
			<if test="effectStartTime != null">
				effect_start_time,
			</if>
			<if test="effectEndTime != null">
				effect_end_time,
			</if>
			<if test="couponUnitStatus != null">
				coupon_unit_status,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
			<if test="platformId != null">
				platform_id,
			</if>
			<if test="batchIndex!= null">
				batch_index,
			</if>
			<if test="couponBatchName != null">
				coupon_batch_name,
			</if>
			<if test="isRead != null">
				is_read,
			</if>
        </trim>		
		) VALUES (
        <trim suffixOverrides=",">
			<if test="receivedTime != null">
				#{receivedTime},
			</if>
			<if test="couponUnitCode != null">
				#{couponUnitCode},
			</if>
			<if test="couponId != null">
				#{couponId},
			</if>
			<if test="couponBatchId != null">
				#{couponBatchId},
			</if>
			<if test="orderId != null">
				#{orderId},
			</if>
			<if test="userId != null">
				#{userId},
			</if>
			<if test="usedTime != null">
				#{usedTime},
			</if>
			<if test="usedCount != null">
				#{usedCount},
			</if>
			<if test="effectStartTime != null">
				#{effectStartTime},
			</if>
			<if test="effectEndTime != null">
				#{effectEndTime},
			</if>
			<if test="couponUnitStatus != null">
				#{couponUnitStatus},
			</if>
			<if test="createTime != null">
				#{createTime},
			</if>
			<if test="updateTime != null">
				#{updateTime},
			</if>
			<if test="platformId != null">
				#{platformId},
			</if>
			<if test="batchIndex != null">
				#{batchIndex},
			</if>
			<if test="couponBatchName != null">
				coupon_batch_name,
			</if>
			<if test="isRead != null">
				is_read,
			</if>
        </trim>		
		)

		<selectKey keyProperty="id" resultType="java.lang.Long">
			select LAST_INSERT_ID()
		</selectKey>
	</insert>


	
	
	<update id="update">
	UPDATE coupon_unit 
		<set>
			<if test="receivedTime != null">
				received_time=#{receivedTime},
			</if>
			<if test="couponUnitCode != null">
				coupon_unit_code = #{couponUnitCode},
			</if>			
			<if test="couponId != null">
				coupon_id = #{couponId},
			</if>			
			<if test="couponBatchId != null">
				coupon_batch_id = #{couponBatchId},
			</if>			
			<if test="orderId != null">
				order_id = #{orderId},
			</if>			
			<if test="userId != null">
				user_id = #{userId},
			</if>			
			<if test="usedTime != null">
				used_time = #{usedTime},
			</if>			
			<if test="usedCount != null">
				used_count = #{usedCount},
			</if>			
			<if test="effectStartTime != null">
				effect_start_time = #{effectStartTime},
			</if>			
			<if test="effectEndTime != null">
				effect_end_time = #{effectEndTime},
			</if>			
			<if test="couponUnitStatus != null">
				coupon_unit_status = #{couponUnitStatus},
			</if>			
			<if test="createTime != null">
				create_time = #{createTime},
			</if>			
			<if test="updateTime != null">
				update_time = #{updateTime},
			</if>	
			<if test="platformId != null">
				platform_id = #{platformId},
			</if>
			<if test="batchIndex != null">
				batch_index = #{batchIndex},
			</if>
			<if test="couponBatchName != null">
				coupon_batch_name = #{couponBatchName},
			</if>
			<if test="isRead != null">
				is_read = #{isRead},
			</if>
		</set>
			WHERE id = #{id}
	</update>


	<update id="updateByParam">
		UPDATE coupon_unit
		<set>
			<if test="po.receivedTime != null">
				received_time=#{po.receivedTime},
			</if>

			<if test="po.couponId != null">
				coupon_id = #{po.couponId},
			</if>
			<if test="po.couponBatchId != null">
				coupon_batch_id = #{po.couponBatchId},
			</if>
			<if test="po.orderId != null">
				order_id = #{po.orderId},
			</if>
			<if test="po.userId != null">
				user_id = #{po.userId},
			</if>
			<if test="po.usedTime != null">
				used_time = #{po.usedTime},
			</if>
			<if test="po.usedCount != null">
				used_count = #{po.usedCount},
			</if>
			<if test="po.effectStartTime != null">
				effect_start_time = #{po.effectStartTime},
			</if>
			<if test="po.effectEndTime != null">
				effect_end_time = #{po.effectEndTime},
			</if>
			<if test="po.couponUnitStatus != null">
				coupon_unit_status = #{po.couponUnitStatus},
			</if>
			<if test="po.createTime != null">
				create_time = #{po.createTime},
			</if>
			<if test="po.updateTime != null">
				update_time = #{po.updateTime},
			</if>
			<if test="po.platformId != null">
				platform_id = #{po.platformId},
			</if>
			<if test="po.batchIndex != null">
				batch_index = #{po.batchIndex},
			</if>
			<if test="po.couponBatchName != null">
				coupon_batch_name = #{po.couponBatchName},
			</if>
			<if test="po.isRead != null">
				is_read = #{po.isRead},
			</if>
		</set>
		WHERE coupon_unit_code=#{po.couponUnitCode}
	</update>


	
	<update id="updateForNull">
	UPDATE coupon_unit 
		<set>
			<if test="po.receivedTime != null">
				received_time=#{po.receivedTime},
			</if>
			<if test="po.couponUnitCode != null">
				coupon_unit_code = #{po.couponUnitCode},
			</if>			
			<if test="po.couponId != null">
				coupon_id = #{po.couponId},
			</if>			
			<if test="po.couponBatchId != null">
				coupon_batch_id = #{po.couponBatchId},
			</if>			
			<if test="po.userId != null">
				user_id = #{po.userId},
			</if>			
			<if test="po.usedCount != null">
				used_count = #{po.usedCount},
			</if>			
			<if test="po.effectStartTime != null">
				effect_start_time = #{po.effectStartTime},
			</if>			
			<if test="po.effectEndTime != null">
				effect_end_time = #{po.effectEndTime},
			</if>			
			<if test="po.couponUnitStatus != null">
				coupon_unit_status = #{po.couponUnitStatus},
			</if>			
			<if test="po.createTime != null">
				create_time = #{po.createTime},
			</if>			
			<if test="po.updateTime != null">
				update_time = #{po.updateTime},
			</if>
			<if test="po.platformId != null">
				platform_id = #{po.platformId},
			</if>
			<if test="true">
				order_id = #{po.orderId},
			</if>			
			<if test="true">
				used_time = #{po.usedTime},
			</if>
			<if test="po.couponBatchName != null">
				coupon_batch_name = #{po.couponBatchName},
			</if>
			<if test="po.isRead != null">
				is_read = #{po.isRead},
			</if>
		</set>
			WHERE id = #{po.id}
	</update>	
	

	<delete id="delete">
		delete from coupon_unit where id = #{id}
	</delete>

	<delete id="deleteByPara">
		delete from coupon_unit 
		<where>
			<if test="receivedTime != null">
				AND received_time=#{receivedTime}
			</if>
			<if test="couponUnitCode != null">
				and coupon_unit_code = #{couponUnitCode}
			</if>
			<if test="couponId != null">
				and coupon_id = #{couponId}
			</if>
			<if test="couponBatchId != null">
				and coupon_batch_id = #{couponBatchId}
			</if>
			<if test="orderId != null">
				and order_id = #{orderId}
			</if>
			<if test="userId != null">
				and user_id = #{userId}
			</if>
			<if test="usedTime != null">
				and used_time = #{usedTime}
			</if>
			<if test="usedCount != null">
				and used_count = #{usedCount}
			</if>
			<if test="effectStartTime != null">
				and effect_start_time = #{effectStartTime}
			</if>
			<if test="effectEndTime != null">
				and effect_end_time = #{effectEndTime}
			</if>
			<if test="couponUnitStatus != null">
				and coupon_unit_status = #{couponUnitStatus}
			</if>
			<if test="createTime != null">
				and create_time = #{createTime}
			</if>
			<if test="updateTime != null">
				and update_time = #{updateTime}
			</if>
			<if test="couponBatchName != null">
				and coupon_batch_name = #{couponBatchName}
			</if>
		</where>
	</delete>

	<insert id="insertCouponUnitList">

				INSERT INTO coupon_unit(
						coupon_unit_code,
						coupon_id,
						coupon_batch_id,
						effect_start_time,
						effect_end_time,
						coupon_unit_status,
						platform_id,
						received_time,
						batch_index
				) VALUES

		<foreach collection="poList" item="po" separator=",">
		(			#{po.couponUnitCode},
						#{po.couponId},
						#{po.couponBatchId},
						#{po.effectStartTime},
						#{po.effectEndTime},
						#{po.couponUnitStatus},
						#{po.platformId},
						#{po.receivedTime},
						#{po.batchIndex}
				)

		</foreach>
	</insert>


	<update id="updateCouponUnitStatusByParamsWithTx">
		UPDATE coupon_unit
		<set>
			coupon_unit_status = 4
			, invalid_time=#{data}
		</set>
		WHERE coupon_batch_id=#{couponBatchId}
		and batch_index >= #{startNum}
		and #{endNum}>=batch_index
		AND coupon_unit_status=0
	</update>

	<update id="updateCouponUnitLockedByCouponUnitId">
		UPDATE coupon_unit
		<set>
			exchange_status= 1
		</set>
		WHERE id = #{couponUnitId}
		and exchange_status=0
	</update>

	<update id="updateCouponUnitRemoveLock">
		UPDATE coupon_unit
		<set>
			exchange_status= 0
		</set>
		WHERE coupon_unit_code = #{oldUnitCode}
	</update>
	
	<update id="updateCouponUnitReadStatus">
		UPDATE coupon_unit
		<set>
			is_read = 1
		</set>
		WHERE id IN
		(
		<foreach collection="ids" item="id" separator=",">
			#{id}
		</foreach>
		)
	</update>



</mapper>
	